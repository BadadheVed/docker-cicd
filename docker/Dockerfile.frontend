FROM oven/bun:1 AS base

ARG DATABASE_URL
WORKDIR /apps

# Copy root files
COPY package.json ./package.json
COPY bun.lock ./bun.lock
COPY turbo.json ./turbo.json
COPY packages ./packages
COPY apps/web ./apps/web

# Install all dependencies at root (monorepo)
RUN bun install

# Generate DB client if needed
RUN bun run db:generate

# Build the frontend workspace
WORKDIR /apps/web
RUN DATABASE_URL=${DATABASE_URL} bun run build

EXPOSE 3000

# Start the frontend
CMD ["bun", "run", "start"]
